<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test Interactivo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .opcion {
      background-color: #f1f5f9;
      border-radius: 10px;
      padding: 10px 20px;
      cursor: pointer;
      margin-bottom: 10px;
      transition: background 0.3s;
    }
    .opcion:hover {
      background-color: #dbeafe;
    }
    .opcion.correcta {
      background-color: #a7f3d0;
    }
    .opcion.incorrecta {
      background-color: #fecaca;
    }
    .pantalla-carga {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: white;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
  </style>
</head>
<body class="bg-light">

<!-- Pantalla de carga inicial -->
<div id="pantalla-carga" class="pantalla-carga">
  <p>Cargando preguntas...</p>
  <div class="spinner-border text-primary" role="status"></div>
</div>

<!-- Contenido del test (oculto al inicio) -->
<div class="container mt-5" id="quiz-container" style="display: none;">
  <div class="card shadow p-4" id="cardPregunta">
    <h5 id="preguntaTitulo"><strong>Pregunta #1</strong></h5>
    <p id="preguntaTexto">Cargando pregunta...</p>
    <div id="opciones"></div>
    <div id="respuestaFeedback" class="mt-3"></div>
    <button class="btn btn-primary mt-3" id="btnSiguiente" onclick="siguientePregunta()" style="display: none;">
      Siguiente pregunta
    </button>
  </div>
</div>

<script>
let preguntas = [];
let indiceActual = 0;
let esperando = false;

// Obtener el nivel desde la URL
const urlParams = new URLSearchParams(window.location.search);
const nivelSeleccionado = urlParams.get('nivel'); // Ejemplo: "1", "2", etc.

function cargarPreguntas() {
  fetch(`https://script.google.com/macros/s/AKfycbwQjzJpunehvKsmBr7fUeeqN7h0eUqv20OHKzeYURHLm3BPn5TzYsXHoA9r25d9bb9a9w/exec?nivel=${nivelSeleccionado}`)
    .then(res => res.json())
    .then(data => {
      preguntas = data.preguntas;
      document.getElementById('pantalla-carga').style.display = 'none';
      document.getElementById('quiz-container').style.display = 'block';
      mostrarPregunta();
    })
    .catch(error => {
      alert('Error al cargar preguntas');
      console.error(error);
    });
}

function mostrarPregunta() {
  const pregunta = preguntas[indiceActual];
  document.getElementById('preguntaTitulo').innerText = `Pregunta #${indiceActual + 1}`;
  document.getElementById('preguntaTexto').innerText = pregunta.pregunta;
  const contenedor = document.getElementById('opciones');
  contenedor.innerHTML = '';

  pregunta.opciones.forEach((opcion, idx) => {
    const div = document.createElement('div');
    div.className = 'opcion';
    div.innerText = opcion;
    div.onclick = () => seleccionarOpcion(idx, div);
    contenedor.appendChild(div);
  });

  document.getElementById('respuestaFeedback').innerHTML = '';
  document.getElementById('btnSiguiente').style.display = 'none';
  esperando = false;
}

function seleccionarOpcion(indice, elemento) {
  if (esperando) return;
  esperando = true;

  const correcta = preguntas[indiceActual].correcta;
  const opciones = document.querySelectorAll('.opcion');

  opciones.forEach((el, idx) => {
    el.classList.remove('correcta', 'incorrecta');
    if (idx === correcta) el.classList.add('correcta');
    if (idx === indice && idx !== correcta) el.classList.add('incorrecta');
    el.style.pointerEvents = 'none';
  });

  const feedback = document.getElementById('respuestaFeedback');
  if (indice === correcta) {
    feedback.innerHTML = `<span class="text-success fw-bold">✅ ¡Correcto!</span>`;
  } else {
    const textoCorrecto = preguntas[indiceActual].opciones[correcta];
    feedback.innerHTML = `<span class="text-danger fw-bold">❌ Incorrecto. La respuesta correcta es: "${textoCorrecto}"</span>`;
  }

  document.getElementById('btnSiguiente').style.display = 'inline-block';
}

function siguientePregunta() {
  indiceActual++;
  if (indiceActual >= preguntas.length) {
    document.getElementById('quiz-container').innerHTML = `<div class="alert alert-success">¡Test finalizado!</div>`;
    return;
  }

  mostrarPregunta(); // Cambio inmediato sin loader ni delay
}

window.onload = cargarPreguntas;

</script>

</body>
</html>
