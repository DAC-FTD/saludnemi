<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Test - Nivel 1</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;700&family=Nunito:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body {
        background-color: #1C3247;
        font-family: 'Nunito','Fredoka', sans-serif;
      }

    .opcion {
      background-color: #e9edee;
      color: #1C3247;
      border-radius: 10px;
      padding: 10px 20px;
      cursor: pointer;
      margin-bottom: 10px;
      transition: background 0.3s;
    }
    .opcion:hover {
      background-color: #bbcce2;
    }
    .opcion.correcta {
      background-color: #80dbae;
    }
    .opcion.incorrecta {
      background-color: #f1b5b5;
    }
    .pantalla-carga {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background-color: #1C3247;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }

    .card {
      background-color: rgb(15, 134, 150);
      color:rgb(255, 255, 255);
      border-radius: 1.5rem;
      padding: 1rem;
      padding-left: 2rem;
      padding-right: 2rem;
    }

    .alert-success {
      background-color: #80dbae !important;
      color: #368039;
      height: auto;
      width: auto;
    }

    .alert-danger {
      background-color: #f1b5b5 !important;
      color: #a53124;
      height: auto;
      width: auto;
    }

    .btnRetro {
      background-color: #ee8f00 ;
      color: white;
      border: none;
      width: 40%;
      transition: background-color 0.3s ease;
    }

    .btnRetro:hover {
      background-color: #c27400;
    }

    .btnSiguiente {
      background-color: #2caa30;
      color: white;
      border: none;
      width: 40%;
      transition: background-color 0.3s ease;
    }

    .btnSiguiente:hover {
      background-color: #3e8e41;
    }

    /* Tamaño del modal por defecto (para móviles) */
    .custom-modal-size {
      max-width: 80%;
      margin: auto;
    }

    /* Cofiguración (para móviles) */
    @media (max-width: 576px) {
      #cardPregunta {
        font-size: 15px;
        padding: 1.5rem;
      }

      .opcion {
        padding: 10px 14px;
        font-size: 14px;
      }

      #preguntaTexto {
        font-size: 15px;
      }

      button {
        width: 50%;
        font-size: 15px;
        margin-bottom: 0.5rem;
      }

      #respuestaFeedback {
        font-size: 14px;
      }
    }

  </style>
</head>
<body>

<!-- Pantalla de carga inicial -->
<div id="pantalla-carga" class="pantalla-carga">
  <p style="color: white;" >Cargando preguntas...</p>
  <div class="spinner-border text-white" role="status"></div>
</div>

<!-- Contenido del test (oculto al inicio) -->
<div class="container-fluid min-vh-100 d-flex align-items-center justify-content-center" id="quiz-container" style="display: none;">
  <div class="row justify-content-center">
    <div class="col-12 col-md-8 col-lg-10">
      <div class="d-flex justify-content-between mb-3">
        <a href="index.html" class="btn btn-outline-secondary fw-bold">
          ← Regresar
        </a>
      </div>
      <div class="card shadow" id="cardPregunta">
      <h4 id="preguntaTitulo" class="fw-bold">Pregunta #1</h4>
      <p id="preguntaTexto" style="text-align: justify;">Cargando pregunta...</p>
      <div id="opciones"></div>
      <div class="row">
      <div id="respuestaFeedback" class="mt-2 col-lg-6"></div>
      <div class="mt-3 col-lg-6 d-flex flex-column align-items-end gap-2">
        <button class="btn btnRetro mb-1" id="btnRetro" style="display: none; width: 40%;" data-bs-toggle="modal" data-bs-target="#modalRetro">
          Ver retroalimentación
        </button>
        <button class="btn btnSiguiente" id="btnSiguiente" onclick="siguientePregunta()" style="display: none; width: 40%">
          Siguiente pregunta
        </button>
      </div>
      </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Retroalimentación -->
<div class="modal fade" id="modalRetro" tabindex="-1" aria-labelledby="modalRetroLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable custom-modal-size">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalRetroLabel">Retroalimentación</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>
      <div class="modal-body" id="contenidoRetro">
        <!-- Aquí se insertará la retroalimentación -->
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
      </div>
    </div>
  </div>
</div>

<script>
let preguntas = [];
let indiceActual = 0;
let esperando = false;

// Obtener el nivel desde la URL
const urlParams = new URLSearchParams(window.location.search);
const nivelSeleccionado = urlParams.get('nivel'); // Ejemplo: "1", "2", etc.

function cargarPreguntas() {
  fetch(`https://script.google.com/macros/s/AKfycbwQjzJpunehvKsmBr7fUeeqN7h0eUqv20OHKzeYURHLm3BPn5TzYsXHoA9r25d9bb9a9w/exec?nivel=${nivelSeleccionado}`)
    .then(res => res.json())
    .then(data => {
      preguntas = data.preguntas;
      document.getElementById('pantalla-carga').style.display = 'none';
      document.getElementById('quiz-container').style.display = 'block';
      mostrarPregunta();
    })
    .catch(error => {
      alert('Error al cargar preguntas');
      console.error(error);
    });
}

function mostrarPregunta() {
  const pregunta = preguntas[indiceActual];
  document.getElementById('preguntaTitulo').innerText = `Pregunta #${indiceActual + 1}`;
  document.getElementById('preguntaTexto').innerText = pregunta.pregunta;
  const contenedor = document.getElementById('opciones');
  contenedor.innerHTML = '';

  pregunta.opciones.forEach((opcion, idx) => {
    const div = document.createElement('div');
    div.className = 'opcion';
    div.innerText = opcion;
    div.onclick = () => seleccionarOpcion(idx, div);
    contenedor.appendChild(div);
  });

  document.getElementById('respuestaFeedback').innerHTML = '';
  document.getElementById('btnSiguiente').style.display = 'none';
  document.getElementById('btnRetro').style.display = 'none';
  esperando = false;
}

function seleccionarOpcion(indice, elemento) {
  if (esperando) return;
  esperando = true;

  const correcta = preguntas[indiceActual].correcta;
  const opciones = document.querySelectorAll('.opcion');

opciones.forEach((el, idx) => {
  el.classList.remove('correcta', 'incorrecta');

  // Si la respuesta es correcta, marcar solo esa opción como correcta
  if (indice === correcta && idx === indice) {
    el.classList.add('correcta');
  }

  // Si la respuesta es incorrecta, marcar solo la opción seleccionada como incorrecta
  if (indice !== correcta && idx === indice) {
    el.classList.add('incorrecta');
  }

  el.style.pointerEvents = 'none';
});

  const feedback = document.getElementById('respuestaFeedback');
  if (indice === correcta) {
    feedback.innerHTML = `
      <div class="alert alert-success d-flex align-items-center gap-2 mb-0 p-2 rounded">
        <i class="bi bi-check-circle-fill"></i>
        <span class="fw-semibold">¡Correcto!</span>
      </div>`;
  } else {
    const textoCorrecto = preguntas[indiceActual].opciones[correcta];
    feedback.innerHTML = `
      <div class="alert alert-danger d-flex align-items-center gap-2 mb-0 p-2 rounded">
        <i class="bi bi-x-circle-fill"></i>
        <span>
          <strong>Incorrecto.</strong><br>
          La respuesta correcta es: "${textoCorrecto}"
        </span>
      </div>`;
  }

  // Mostrar retroalimentación adicional si existe
  const retro = preguntas[indiceActual].retro;
  if (retro && retro.trim() !== "") {
    document.getElementById('btnRetro').style.display = 'inline-block';
    document.getElementById('contenidoRetro').innerText = retro;
  } else {
    document.getElementById('btnRetro').style.display = 'none';
  }
  document.getElementById('btnSiguiente').style.display = 'inline-block';
}

function siguientePregunta() {
  indiceActual++;
  if (indiceActual >= preguntas.length) {
    document.getElementById('quiz-container').innerHTML = `<div class="alert alert-success">¡Test finalizado!</div>`;
    return;
  }

  mostrarPregunta(); // Cambio inmediato sin loader ni delay
}

window.onload = cargarPreguntas;

</script>



</body>
</html>
